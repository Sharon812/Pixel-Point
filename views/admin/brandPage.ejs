<%- include("../layouts/admin/header.ejs") %>
<link rel="stylesheet" href="/css/admin/brands.css" />
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/cropperjs/dist/cropper.min.css"
/>

<div class="admin-dashboard">
  <div class="d-flex">
    <!-- Main Content -->
    <div class="main-content flex-grow-1">
      <div class="container-fluid">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h1 class="h3 text-gray-800">Brand Management</h1>
          <div class="date text-secondary">
            <i class="far fa-calendar-alt me-2"></i>
            <span id="currentDate"></span>
          </div>
        </div>

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="/admin"><i class="fas fa-home me-2"></i>Dashboard</a>
            </li>
            <li class="breadcrumb-item active">Brands</li>
          </ol>
        </nav>

        <!-- Brands Table -->
        <div class="brand-management">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="mb-0">All Brands</h5>
            <button
              class="btn btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#addBrandModal"
            >
              <i class="fas fa-plus me-2"></i>Add New Brand
            </button>
          </div>

          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Brand Name</th>
                  <th>Logo</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% brands.forEach(brand => { %>
                <tr>
                  <td class="align-middle">
                    <div class="d-flex align-items-center">
                      <span class="ms-2"><%= brand.brandName %></span>
                    </div>
                  </td>
                  <td>
                    <img
                      src="<%= brand.brandImage %>"
                      alt="<%= brand.name %>"
                      width="50"
                      height="50"
                      class="rounded-circle border"
                    />
                  </td>
                  <td class="align-middle">
                    <% if(!brand.isBlocked) { %>
                    <span id="badge-<%= brand.brandName %>" class="badge bg-success"
                      >Active</span
                    >
                    <% } else { %>
                    <span id="badge-<%= brand.brandName %>" class="badge bg-danger"
                      >Inactive</span
                    >
                    <% } %>
                  </td>
                  <td class="align-middle">
                    <div class="btn-group">
                      <button
                        class="btn btn-sm btn-outline-primary"
                        onclick='updateBrand("<%= brand.id %>")'
                      >
                        <i class="fas fa-edit me-1"></i>Edit
                      </button>
                      <% if(!brand.isBlocked) { %>
                      <button
                        id="icon-<%=brand.brandName%>"
                        data-id-<%=brand.brandName%> ="<%= brand._id %>"
                        onclick="blockBrand('<%=brand._id%>')" class="btn btn-sm
                        btn-outline-danger" >
                        <i class="fas fa-ban me-1"></i>Block
                      </button>
                      <% } else { %>
                      <button
                        id="icon-<%=brand.brandName%>"
                        data-id-<%=brand.brandName%> ="<%= brand._id %>"
                        onclick="unblockBrand('<%=brand._id%>')"
                        class="btn btn-sm btn-outline-success"
                      >
                        <i class="fas fa-undo me-1"></i>Restore
                      </button>
                      <% } %>
                    </div>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <% if (totalPages > 0) { %>
          <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
              <% if (currentPage > 1) { %>
              <li class="page-item">
                <a class="page-link" href="?page=<%= currentPage - 1 %>">
                  <i class="fas fa-chevron-left"></i>
                </a>
              </li>
              <% } %> <% for (let i = 1; i <= totalPages; i++) { %>
              <li class="page-item <%= (i === currentPage) ? 'active' : '' %>">
                <a class="page-link" href="?page=<%= i %>"><%= i %></a>
              </li>
              <% } %> <% if (currentPage < totalPages) { %>
              <li class="page-item">
                <a class="page-link" href="?page=<%= currentPage + 1 %>">
                  <i class="fas fa-chevron-right"></i>
                </a>
              </li>
              <% } %>
            </ul>
          </nav>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Brand Modal -->
<div class="modal fade" id="addBrandModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Brand</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <form
        method="post"
        action="/admin/addBrands"
        enctype="multipart/form-data"
      >
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Brand Name</label>
            <input type="text" class="form-control" name="name" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Brand Logo</label>
            <input
              type="file"
              class="form-control"
              name="image"
              accept=".jpg, .jpeg, .png"
              required
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">Add Brand</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cropperjs/dist/cropper.min.js"></script>

<script src="/scripts/admin/brands.js"></script>
