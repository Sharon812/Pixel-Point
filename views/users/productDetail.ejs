<%- include("../layouts/users/header.ejs") %>

<!--=============== CSS ===============-->
<link rel="stylesheet" href="/css/users/homepage.css" />

<!--=============== MAIN ===============-->
<main class="main">
  <!--=============== BREADCRUMB ===============-->
  <section class="breadcrumb">
    <ul class="breadcrumb__list flex container">
      <li><a href="/" class="breadcrumb__link">Home</a></li>
      <li><span class="breadcrumb__link"></span>></li>
      <li>
        <a href="/" class="breadcrumb__link"> <%= product.category.name %> </a>
      </li>
      <li><span class="breadcrumb__link"></span>></li>
      <li>
        <span class="breadcrumb__link"> <%= product.productName %> </span>
      </li>
    </ul>
  </section>

  <!--=============== DETAILS ===============-->
  <section class="details section--lg">
    <div class="details__container container grid">
      <div class="details__group">
        <div class="img-zoom-container">
          <img src="<%= product.productImage[0] %>" alt="" class="details__img">
        </div>
        <div class="details__small-images grid">
          <% for(let i = 0; i< product.productImage.length;i++) {%>
          <img
            src=" <%= product.productImage[i] %> "
            alt=""
            class="details__small-img"
          />
          <% } %>
        </div>
      </div>
      <div class="details__group">
        <h3 class="details__title"><%= product.productName %></h3>
        <p class="details__brand">
          Brand: <span> <%= product.brand.brandName %> </span>
        </p>
        <% if(product.combos[0].discountedPrice) {%>
        <div class="details__price flex">
          <span id="currentPrice" class="new__price">
            ₹<%= product.combos[0].discountedPrice.toLocaleString() %></span
          >
          <span class="old__price" id="regularPrice">
            ₹<%= product.combos[0].salePrice.toLocaleString() %>
          </span>
          <% 
          const regularPrice = product.combos[0].salePrice;
          const salePrice = product.combos[0].discountedPrice;
          const discount = Math.round(((regularPrice - salePrice) / regularPrice) * 100);
        %>
          <span class="offer-badge" style="background: #113c7c; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; margin-left: 8px;">
           <%= discount %>% off
          </span>
          </div>
          <% }else{ %>
            <div class="details__price flex">
              <span id="currentPrice" class="new__price">
                ₹<%= product.combos[0].salePrice.toLocaleString() %></span
              >
              <span class="old__price" id="regularPrice">
                ₹<%= product.combos[0].regularPrice.toLocaleString() %>
              </span>
              <% 
              const regularPrice = product.combos[0].regularPrice;
              const salePrice = product.combos[0].salePrice;
              const discount = Math.round(((regularPrice - salePrice) / regularPrice) * 100);
            %>
              <span class="offer-badge" style="background: #113c7c; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; margin-left: 8px;">
               <%= discount %>% off
              </span>
              </div>
            <% } %>
        <p class="short__description"><%= product.description %></p>
        <ul class="products__list">
          <li class="list__item flex">
            <i class="fi-rs-crown"></i> 1 Year Brand Warranty
          </li>
          <li class="list__item flex">
            <i class="fi-rs-refresh"></i> 30 Days Return Policy
          </li>
          <li class="list__item flex">
            <i class="fi-rs-credit-card"></i> Cash on Delivery available
          </li>
        </ul>
        <div class="details__color flex">
          <span class="details__color-title">Color</span>
          <ul class="color__list">
            <li>
              <a
                href="#"
                class="color__link"
                style="background-color: hsl(37, 100%, 65%)"
              ></a>
            </li>
            <li>
              <a
                href="#"
                class="color__link"
                style="background-color: hsl(353, 100%, 65%)"
              ></a>
            </li>
            <li>
              <a
                href="#"
                class="color__link"
                style="background-color: hsl(49, 100%, 60%)"
              ></a>
            </li>
            <li>
              <a
                href="#"
                class="color__link"
                style="background-color: hsl(304, 100%, 78%)"
              ></a>
            </li>
            <li>
              <a
                href="#"
                class="color__link"
                style="background-color: hsl(126, 61%, 52%)"
              ></a>
            </li>
          </ul>
        </div>
        <div class="details__size flex" data-*>
          <!-- <span class="details__size-title">Size</span> -->
          <ul class="size__list">
            <li>
              <!-- <a href="#" class="size__link size-active"></a> -->
              <% product.combos.forEach((combo, index) => { %>
                <button
                  
                  type="button"
                  data-product-id="<%= product._id %>"
                  data-combos-id = "<%= combo._id  %>"
                  data-combo-quantity = "<%= combo.quantity %>"
                  data-ram="<%= combo.ram %>"
                  data-storage="<%= combo.storage %>"
                  data-color="<%= combo.color %>"
                  class="size__link <%= index === 0 ? 'size__link size-active' : 'size__link' %> combo-option"
                  aria-label="Select combo: <%= combo.ram %>GB RAM, <%= combo.storage %>GB Storage, <%= combo.color %> color"
                  onclick="selectCombo(this)"
                >
                  <%= combo.ram %>GB / <%= combo.storage %>GB / <%= combo.color %>
                </button>
              <% }); %>
            </li>
          </ul>
        </div>
        <% if(product.combos[0].quantity > 0 ) {%>
        <div class="details__action" id="actionButtons">
          <input type="number" class="quantity" min="1" max="5" value="1" />

          <button id="addToCart" onclick="addToCart('<%= product._id %>','<%=product.combos[0]._id%>')"  class="btn btn--sm">Add To Cart</button>
          <% if (wishlistProducts.includes(product._id.toString())) { %>
            <button class="wishlist__btnpro active"
              onclick="removeFromWishlist('<%=product._id %>')"
              aria-label="Add to Wishlist">
              <i class="fi fi-rs-heart"></i>
            </button>
          <% }else{ %>
            <button class="wishlist__btnpro "
            onclick="toggleWishlist('<%=product._id %>')"
            aria-label="Add to Wishlist">
            <i class="fi fi-rs-heart"></i>
          </button>
          <% } %>
        </div>
        <ul class="details__meta">
          <!-- <li class="meta__list flex"><span>SKU:</span>FWM15VKT</li>
          <li class="meta__list flex">
            <span>Tags:</span>Clothes, Women, Dress
          </li> -->
          <li class="meta__list flex">
            <span class="h5">Availability: </span>
            <span class="h4 text-danger" id="quantityStatus">
              <%= product.combos[0].quantity %> 
            </span>
          </li>
        </ul>
        <% } else{ %>
          <div class="details__action" id="actionButtons">
            <button class="btn btn-danger" disabled>Out of Stock</button>
          </div>
          <ul class="details__meta">
            <!-- <li class="meta__list flex"><span>SKU:</span>FWM15VKT</li>
            <li class="meta__list flex">
              <span>Tags:</span>Clothes, Women, Dress
            </li> -->
            <li class="meta__list flex">
              <span class="h5">Availability: </span>
              <span class=" h4 text-danger " id="quantityStatus">Out of Stock</span>
            </li>
          </ul>
          <% } %>
      </div>
    </div>
  </section>

  <!--=============== DETAILS TAB ===============-->
  <section class="details__tab container">
    <div class="detail__tabs">
      <span class="detail__tab active-tab" data-target="#info">
        Additional Info
      </span>
      <span class="detail__tab" data-target="#reviews">Reviews(3)</span>
    </div>
    <div class="details__tabs-content">
      <div class="details__tab-content active-tab" content id="info">
        <table class="info__table">
          <tr>
            <th>GPU</th>
            <td>NVIDIA</td>
          </tr>
          <tr>
            <th>Processor</th>
            <td>M3 chip</td>
          </tr>
          <tr>
            <th>Storage</th>
            <td>256GB</td>
          </tr>
          <tr>
            <th>Ram</th>
            <td>12GB</td>
          </tr>
          <tr>
            <th>Color</th>
            <td>Black, Blue, Red, White</td>
          </tr>
          
        </table>
      </div>
      <div class="details__tab-content" content id="reviews">
        <div class="reviews__container grid">
          <div class="review__single">
            <div>
              <img src="/img/avatar-1.jpg" alt="" class="review__img" />
              <h4 class="review__title">Jacky Chan</h4>
            </div>
            <div class="review__data">
              <div class="review__rating">
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
              </div>
              <p class="review__description">
                Thank you, very fast shipping from Poland only 3days.
              </p>
              <span class="review__date">December 4, 2022 at 3:12 pm</span>
            </div>
          </div>
          <div class="review__single">
            <div>
              <img src="/img/avatar-2.jpg" alt="" class="review__img" />
              <h4 class="review__title">Meriem Js</h4>
            </div>
            <div class="review__data">
              <div class="review__rating">
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
              </div>
              <p class="review__description">Great low price and works well</p>
              <span class="review__date">August 23, 2022 at 19:45 pm</span>
            </div>
          </div>
          <div class="review__single">
            <div>
              <img src="/img/avatar-3.jpg" alt="" class="review__img" />
              <h4 class="review__title">Moh Benz</h4>
            </div>
            <div class="review__data">
              <div class="review__rating">
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
              </div>
              <p class="review__description">
                Authentic and beautiful, Love these ways more than ever
                expected, They are great earphones.
              </p>
              <span class="review__date">March 2, 2021 at 10:01 am</span>
            </div>
          </div>
        </div>
        <div class="review__form">
          <h4 class="review__form-title">Add a review</h4>
          <div class="rate__product">
            <i class="fi fi-rs-star"></i>
            <i class="fi fi-rs-star"></i>
            <i class="fi fi-rs-star"></i>
            <i class="fi fi-rs-star"></i>
            <i class="fi fi-rs-star"></i>
          </div>
          <form action="" class="form grid">
            <textarea
              class="form__input textarea"
              placeholder="Write Comment"
            ></textarea>
            <div class="form__group grid">
              <input type="text" placeholder="Name" class="form__input" />
              <input type="email" placeholder="Email" class="form__input" />
            </div>
            <div class="form__btn">
              <button class="btn">Submit Review</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!--=============== PRODUCTS ===============-->
  <section class="products container section--lg">
    <h3 class="section__title"><span>Related</span> Products</h3>
    <div class="products__container grid">
      <% for(let i = 0; i <relatedProducts.length; i++) { %>
      <div class="product__item">
        <div class="product__banner">
          <a href="/productDetails/<%= relatedProducts[i]._id %>" class="product__images">
            <img
              src=" <%= relatedProducts[i].productImage[0] %> "
              alt=""
              class="product__img default"
            />
            <img src="<%= relatedProducts[i].productImage[0] %>" alt="" class="product__img hover" />
          </a>
          <div class="product__actions">
            <a href="#" class="action__btn" aria-label="Quick View">
              <i class="fi fi-rs-eye"></i>
            </a>
            <a href="#" class="action__btn" aria-label="Add to Wishlist">
              <i class="fi fi-rs-heart"></i>
            </a>
            <a href="#" class="action__btn" aria-label="Compare">
              <i class="fi fi-rs-shuffle"></i>
            </a>
          </div>
          <div class="product__badge light-pink">Hot</div>
        </div>

        <div class="product__content">
          <span class="product__category"> <%= relatedProducts[i].brand.brandName %> </span>
          <a href="details.html">
            <h3 class="product__title"> <%= relatedProducts[i].productName %> </h3>
          </a>
          <div class="product__rating">
            <i class="fi fi-rs-star"></i>
            <i class="fi fi-rs-star"></i>
            <i class="fi fi-rs-star"></i>
            <i class="fi fi-rs-star"></i>
            <i class="fi fi-rs-star"></i>
          </div>
          <div class="product__price flex">
            <span class="new__price">₹<%= relatedProducts[i].combos[0].salePrice %> </span>
            <span class="old__price">₹<%= relatedProducts[i].combos[0].regularPrice %> </span>
          </div>
          <a href="#" class="action__btn cart__btn" aria-label="Add To Cart">
            <i class="fi fi-rs-shopping-bag-add"></i>
          </a>
        </div>
      </div>
      <% } %>
      </div>
    </div>
  </section>

  <!--=============== NEWSLETTER ===============-->
  <section class="newsletter section">
    <div class="newsletter__container container grid">
      <h3 class="newsletter__title flex">
        <img src="/img/icon-email.svg" alt="" class="newsletter__icon" />
        Sign in to Newsletter
      </h3>
      <p class="newsletter__description">
        ...and receive $25 coupon for first shopping.
      </p>
      <form action="" class="newsletter__form">
        <input
          type="text"
          placeholder="Enter Your Email"
          class="newsletter__input"
        />
        <button type="submit" class="newsletter__btn">Subscribe</button>
      </form>
    </div>
  </section>
</main>

<!--=============== FOOTER ===============-->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Include jQuery before your script -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!--=============== SWIPER JS ===============-->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<!--=============== MAIN JS ===============-->
<!-- Include jQuery before your script -->

<script src="/scripts/users/product.js"></script>
<script src="/scripts/users/main.js"></script>
<%- include("../layouts/users/footer.ejs") %>
